{% extends 'base.html' %}
{% load static %}

{% block title %}
  {% if q %}
    Search Results for "{{ q }}" - ShopAway
  {% else %}
    Search Products - ShopAway
  {% endif %}
{% endblock %}

{% block content %}
<div class='container-fluid px-3 px-md-4 py-3 py-md-4'>
  <!-- Search Header -->
  <div class='row mb-4'>
    <div class='col-12'>
      {% if q %}
        <h1 class='h3 mb-2'>Search Results for "{{ q }}"</h1>
        <p class='text-muted mb-0'>
          {% if search_results_count > 0 %}
            Found {{ search_results_count }} product{{ search_results_count|pluralize }}
          {% else %}
            No products found for "{{ q }}"
          {% endif %}
        </p>
      {% else %}
        <h1 class='h3 mb-2'>Search Products</h1>
        <p class='text-muted mb-0'>Enter a search term to find products</p>
      {% endif %}
    </div>
  </div>


  <!-- Related Categories -->
  {% if related_categories %}
    <div class='row mb-4'>
      <div class='col-12'>
        <h5 class='mb-3'>Related Categories</h5>
        <div class='d-flex flex-wrap gap-2'>
          {% for category in related_categories %}
            <a href='/search/?q={{ category.name|urlencode }}' class='btn btn-outline-mint btn-sm'>
              {{ category.name }}
            </a>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Search Results -->
  {% if products %}
    <div class='row mb-4'>
      <div class='col-12'>
        <h5 class='mb-3'>Products</h5>
      </div>
    </div>
    
    <div class='row g-3'>
      {% for product in products %}
        <div class='col-6 col-sm-4 col-md-3 col-lg-2'>
          <a href='{% url "product_detail" product.slug %}' class='text-decoration-none product-card-link'>
            <div class='card product-card h-100'>
              {% if product.image %}
                <img src='{{ product.image.url }}' class='card-img-top product-image' alt='{{ product.name }}'>
              {% else %}
                <div class='card-img-top product-image bg-light d-flex align-items-center justify-content-center'>
                  <i class='fa fa-image text-muted fa-2x'></i>
                </div>
              {% endif %}
              
              <div class='card-body d-flex flex-column'>
                <h6 class='card-title product-title'>{{ product.name|truncatechars:50 }}</h6>
                
                <div class='mt-auto'>
                  <div class='d-flex justify-content-between align-items-center mb-2'>
                    <span class='price text-success fw-bold'>৳{{ product.price }}</span>
                    {% if product.stock > 0 %}
                      <small class='text-muted'>In Stock: {{ product.stock }}</small>
                    {% else %}
                      <small class='text-danger'>Out of Stock</small>
                    {% endif %}
                  </div>
                  
                  {% if product.stock > 0 %}
                    <div class='btn btn-outline-dark w-100 btn-sm'>
                      <i class='fa fa-cart-plus me-1'></i>Add to Cart
                    </div>
                  {% else %}
                    <div class='btn btn-outline-secondary w-100 btn-sm'>
                      Out of Stock
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Popular Products (shown when no search results) -->
  {% if popular_products and not products %}
    <div class='row mb-4'>
      <div class='col-12'>
        <h5 class='mb-3'>Popular Products</h5>
        <p class='text-muted'>Try searching for something else, or browse our popular products:</p>
      </div>
    </div>
    
    <div class='row g-3'>
      {% for product in popular_products %}
        <div class='col-6 col-sm-4 col-md-3 col-lg-2'>
          <a href='{% url "product_detail" product.slug %}' class='text-decoration-none product-card-link'>
            <div class='card product-card h-100'>
              {% if product.image %}
                <img src='{{ product.image.url }}' class='card-img-top product-image' alt='{{ product.name }}'>
              {% else %}
                <div class='card-img-top product-image bg-light d-flex align-items-center justify-content-center'>
                  <i class='fa fa-image text-muted fa-2x'></i>
                </div>
              {% endif %}
              
              <div class='card-body d-flex flex-column'>
                <h6 class='card-title product-title'>{{ product.name|truncatechars:50 }}</h6>
                
                <div class='mt-auto'>
                  <div class='d-flex justify-content-between align-items-center mb-2'>
                    <span class='price text-success fw-bold'>৳{{ product.price }}</span>
                    {% if product.stock > 0 %}
                      <small class='text-muted'>In Stock: {{ product.stock }}</small>
                    {% else %}
                      <small class='text-danger'>Out of Stock</small>
                    {% endif %}
                  </div>
                  
                  {% if product.stock > 0 %}
                    <div class='btn btn-outline-dark w-100 btn-sm'>
                      <i class='fa fa-cart-plus me-1'></i>Add to Cart
                    </div>
                  {% else %}
                    <div class='btn btn-outline-secondary w-100 btn-sm'>
                      Out of Stock
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- No Results Message -->
  {% if q and not products and not popular_products %}
    <div class='row'>
      <div class='col-12 text-center py-5'>
        <i class='fa fa-search fa-3x text-muted mb-3'></i>
        <h4 class='text-muted'>No products found</h4>
        <p class='text-muted'>Try searching with different keywords or browse our categories</p>
        <a href='/' class='btn btn-mint'>Browse All Products</a>
      </div>
    </div>
  {% endif %}
</div>

<style>
.product-card-link {
  display: block;
  color: inherit;
  text-decoration: none;
}

.product-card-link:hover {
  color: inherit;
  text-decoration: none;
}

.product-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  cursor: pointer;
}

.product-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.product-card-link:hover .product-card {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.product-image {
  height: 150px;
  object-fit: cover;
}

.product-title {
  font-size: 0.9rem;
  line-height: 1.3;
  min-height: 2.6rem;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.price {
  font-size: 1.1rem;
}

/* Make buttons look like buttons but not clickable */
.product-card .btn {
  pointer-events: none;
  cursor: default;
}

@media (max-width: 768px) {
  .product-image {
    height: 120px;
  }
  
  .product-title {
    font-size: 0.8rem;
    min-height: 2.4rem;
  }
  
  .price {
    font-size: 1rem;
  }
}
</style>
{% endblock %}
